{{- /*
This will generate vault secret config
Maintainer: Arif Hossen
Change history:
20241016: Added Vault Definition
*/}}

{{- define "common.vault-static-secrets" }}

{{- if hasKey .Values "vault"  }}
{{- $checkValueConfig := .Values.vault | default (dict "enabled" false) }}
{{- if $checkValueConfig.enabled }}

---
{{- if hasKey .Values.vault "vaultsecret"  }}
{{- $checkValuevaultsecret := .Values.vault.vaultsecret | default (dict "enabled" false) }}
{{- if $checkValuevaultsecret.enabled }}


apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: vault-{{ .Values.app.name }}-secrets
spec:
  vaultAuthRef: vault-auth
  mount: {{ .Values.env}}
  type: kv-v2
  path:  {{ .Values.vault.vaultsecret.secretPath}}
  refreshAfter: {{ .Values.vault.vaultsecret.refreshAfter}}
  destination:
    create: true
    name: {{ .Values.app.name }}-secrets

  {{- end }}  
{{- end }}  
---
  
  {{- end }}  
{{- end }}  

{{- end }}